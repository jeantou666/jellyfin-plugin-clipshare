<!DOCTYPE html>
<html>
<head>
    <title>ClipShare Configuration</title>
    <style>
        * { box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            padding: 20px;
            background: #101010;
            color: #fff;
            max-width: 800px;
            margin: 0 auto;
        }
        h1 { color: #00a4dc; margin-bottom: 10px; }
        h2 { color: #00a4dc; margin-top: 30px; }
        .section {
            background: #1a1a1a;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        code {
            background: #333;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
            word-break: break-all;
        }
        pre {
            background: #222;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            font-family: monospace;
            font-size: 13px;
        }
        .success {
            background: #1a3a1a;
            border-left: 4px solid #4caf50;
            padding: 15px;
            margin: 15px 0;
        }
        .info {
            background: #2a2a00;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
        }
        button {
            background: #00a4dc;
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0088bb; }
        button:disabled { background: #555; cursor: not-allowed; }
        input[type="number"] {
            width: 100px;
            padding: 8px;
            background: #222;
            color: #fff;
            border: 1px solid #444;
            border-radius: 4px;
        }
        a { color: #00a4dc; }
        .status { display: inline-block; padding: 4px 12px; border-radius: 4px; margin-left: 10px; }
        .status.active { background: #4caf50; }
        .status.inactive { background: #f44336; }
    </style>
</head>
<body>
    <h1>‚úÇÔ∏è ClipShare <span id="version"></span></h1>
    <p>Create and share video clips directly from the Jellyfin player.</p>

    <div class="success">
        <strong>‚úì Plugin Active</strong> - The clip button (‚úÇÔ∏è) appears in the video player controls.<br>
        <strong>Keyboard shortcut:</strong> Press <code>C</code> to start creating a clip.
    </div>

    <div class="section">
        <h2>üé¨ How to Use</h2>
        <ol>
            <li>Start playing a video in Jellyfin</li>
            <li>Click the <strong>‚úÇÔ∏è Clip</strong> button in the player controls (or press <code>C</code>)</li>
            <li>Navigate to the <strong>start point</strong> and click the button</li>
            <li>Navigate to the <strong>end point</strong> and click again</li>
            <li>Click <strong>Create Clip</strong> to generate a shareable link</li>
        </ol>
    </div>

    <div class="section">
        <h2>‚öôÔ∏è Settings</h2>
        <p>
            Default clip expiration: <input type="number" id="expireHours" value="72" min="1" max="720"> hours
            <button onclick="saveSettings()">Save</button>
        </p>
        <p style="color: #888; font-size: 0.9em;">Clips older than this will be automatically deleted.</p>
    </div>

    <div class="section">
        <h2>üìã Script Status</h2>
        <p>Script URL: <code id="scriptUrl"></code></p>
        <p>Injection: <span id="injectionStatus" class="status"></span></p>
        <button onclick="testScript()">Test Script Loading</button>
        <button onclick="reloadScript()">Reload Script</button>
        <div id="testResult" style="margin-top: 10px;"></div>
    </div>

    <div class="info">
        <strong>üí° Tip:</strong> If the clip button doesn't appear, try refreshing the page or manually loading the script using the browser console.
    </div>

    <script>
        const baseUrl = window.location.origin;
        const scriptUrl = baseUrl + '/ClipShare/script';

        document.getElementById('scriptUrl').textContent = scriptUrl;
        document.getElementById('injectionStatus').textContent = 'Active';
        document.getElementById('injectionStatus').className = 'status active';

        // Check if script is already loaded
        if (window.__clipshare_loaded) {
            document.getElementById('injectionStatus').textContent = 'Loaded';
        }

        // Load saved settings
        const savedHours = localStorage.getItem('clipshare_expireHours');
        if (savedHours) {
            document.getElementById('expireHours').value = savedHours;
        }

        function saveSettings() {
            const hours = document.getElementById('expireHours').value;
            localStorage.setItem('clipshare_expireHours', hours);
            alert('Settings saved! Default expiration: ' + hours + ' hours');
        }

        async function testScript() {
            const result = document.getElementById('testResult');
            result.innerHTML = 'Testing...';

            try {
                const resp = await fetch(scriptUrl);
                if (resp.ok) {
                    const text = await resp.text();
                    result.innerHTML = '<span style="color:#4caf50">‚úì Script loaded successfully (' + text.length + ' bytes)</span>';
                } else {
                    result.innerHTML = '<span style="color:#f44336">‚úó Script returned status ' + resp.status + '</span>';
                }
            } catch (e) {
                result.innerHTML = '<span style="color:#f44336">‚úó Error: ' + e.message + '</span>';
            }
        }

        function reloadScript() {
            // Remove old script if exists
            const oldScript = document.querySelector('script[src*="/ClipShare/script"]');
            if (oldScript) oldScript.remove();

            // Reset loaded flag
            window.__clipshare_loaded = false;

            // Load fresh script
            const s = document.createElement('script');
            s.src = scriptUrl + '?t=' + Date.now();
            s.onload = () => {
                document.getElementById('testResult').innerHTML = '<span style="color:#4caf50">‚úì Script reloaded!</span>';
                document.getElementById('injectionStatus').textContent = 'Loaded';
            };
            s.onerror = () => {
                document.getElementById('testResult').innerHTML = '<span style="color:#f44336">‚úó Failed to load script</span>';
            };
            document.head.appendChild(s);
        }
    </script>
</body>
</html>
