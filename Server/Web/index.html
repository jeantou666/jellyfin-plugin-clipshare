<!DOCTYPE html>
<html>
<head>
    <title>ClipShare Configuration</title>
    <style>
        * { box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            padding: 20px;
            background: #101010;
            color: #fff;
            max-width: 900px;
            margin: 0 auto;
            line-height: 1.6;
        }
        h1 { color: #00a4dc; margin-bottom: 10px; }
        h2 { color: #00a4dc; margin-top: 30px; border-bottom: 1px solid #333; padding-bottom: 10px; }
        h3 { color: #ccc; margin-top: 20px; }
        .section {
            background: #1a1a1a;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        code {
            background: #333;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
            word-break: break-all;
        }
        pre {
            background: #222;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            font-family: monospace;
            font-size: 13px;
            white-space: pre-wrap;
        }
        .success {
            background: #1a3a1a;
            border-left: 4px solid #4caf50;
            padding: 15px;
            margin: 15px 0;
        }
        .warning {
            background: #3a2a1a;
            border-left: 4px solid #ff9800;
            padding: 15px;
            margin: 15px 0;
        }
        .info {
            background: #1a2a3a;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin: 15px 0;
        }
        button {
            background: #00a4dc;
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0088bb; }
        button:disabled { background: #555; cursor: not-allowed; }
        input[type="number"] {
            width: 100px;
            padding: 8px;
            background: #222;
            color: #fff;
            border: 1px solid #444;
            border-radius: 4px;
        }
        a { color: #00a4dc; }
        .step {
            display: flex;
            margin: 15px 0;
            align-items: flex-start;
        }
        .step-num {
            background: #00a4dc;
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            flex-shrink: 0;
            font-weight: bold;
        }
        .step-content { flex: 1; }
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 0.85em;
            margin-left: 10px;
        }
        .badge.recommended { background: #4caf50; }
        .badge.easy { background: #ff9800; }
    </style>
</head>
<body>
    <h1>‚úÇÔ∏è ClipShare</h1>
    <p>Create and share video clips directly from the Jellyfin player.</p>

    <div class="success">
        <strong>‚úì Plugin Installed</strong> - The server-side functionality is ready. Now configure script injection to enable the UI.
    </div>

    <div class="section">
        <h2>üöÄ Setup Script Injection</h2>
        <p>Choose one of the following methods to load the ClipShare script:</p>

        <h3>Method 1: JavaScript Injector Plugin <span class="badge recommended">Recommended</span></h3>
        <div class="step">
            <div class="step-num">1</div>
            <div class="step-content">
                Install the <a href="https://github.com/n00bcodr/Jellyfin-JavaScript-Injector" target="_blank">JavaScript Injector</a> plugin.<br>
                Add this repository to Jellyfin: <code>https://n00bcodr.github.io/jellyfin-plugin-repo/manifest.json</code>
            </div>
        </div>
        <div class="step">
            <div class="step-num">2</div>
            <div class="step-content">
                Go to <strong>Dashboard > Plugins > JavaScript Injector</strong>
            </div>
        </div>
        <div class="step">
            <div class="step-num">3</div>
            <div class="step-content">
                Add a new script with this code:
                <pre id="injectorCode"></pre>
                <button onclick="copyInjectorCode()">üìã Copy Code</button>
            </div>
        </div>

        <h3>Method 2: Browser Console <span class="badge easy">Quick Test</span></h3>
        <p>Open the browser console (F12) and paste:</p>
        <pre id="consoleCode"></pre>
        <button onclick="copyConsoleCode()">üìã Copy</button>
        <p class="info" style="margin-top: 10px;"><strong>Note:</strong> This only works for the current session. Use Method 1 for permanent installation.</p>

        <h3>Method 3: Tampermonkey</h3>
        <p>Install <a href="https://www.tampermonkey.net/" target="_blank">Tampermonkey</a> extension, then:</p>
        <button onclick="installUserscript()">üì¶ Download Userscript</button>
    </div>

    <div class="section">
        <h2>üé¨ How to Use</h2>
        <div class="step">
            <div class="step-num">1</div>
            <div class="step-content">Play any video in Jellyfin</div>
        </div>
        <div class="step">
            <div class="step-num">2</div>
            <div class="step-content">Click the <strong>‚úÇÔ∏è Clip</strong> button in player controls (or press <code>C</code>)</div>
        </div>
        <div class="step">
            <div class="step-num">3</div>
            <div class="step-content">Navigate to start point, click button</div>
        </div>
        <div class="step">
            <div class="step-num">4</div>
            <div class="step-content">Navigate to end point, click button</div>
        </div>
        <div class="step">
            <div class="step-num">5</div>
            <div class="step-content">Click <strong>Create Clip</strong> and share the link!</div>
        </div>
    </div>

    <div class="section">
        <h2>‚öôÔ∏è Settings</h2>
        <p>
            Default clip expiration: <input type="number" id="expireHours" value="72" min="1" max="720"> hours
            <button onclick="saveSettings()">Save</button>
        </p>
        <p style="color: #888; font-size: 0.9em;">Clips older than this will be automatically deleted.</p>
    </div>

    <div class="section">
        <h2>üìã Script Status</h2>
        <p>Script URL: <code id="scriptUrl"></code></p>
        <button onclick="testScript()">Test Script</button>
        <button onclick="reloadScript()">Reload Script</button>
        <div id="testResult" style="margin-top: 10px;"></div>
    </div>

    <script>
        const baseUrl = window.location.origin;
        const scriptUrl = baseUrl + '/ClipShare/script';

        document.getElementById('scriptUrl').textContent = scriptUrl;

        // Injector code
        const injectorCode = `// ClipShare Auto-Loader
var s=document.createElement('script');s.src='${scriptUrl}';document.head.appendChild(s);`;
        document.getElementById('injectorCode').textContent = injectorCode;

        // Console code
        const consoleCode = `// Load ClipShare
(function(){var s=document.createElement('script');s.src='${scriptUrl}';document.head.appendChild(s);})();`;
        document.getElementById('consoleCode').textContent = consoleCode;

        // Load saved settings
        const savedHours = localStorage.getItem('clipshare_expireHours');
        if (savedHours) {
            document.getElementById('expireHours').value = savedHours;
        }

        function copyInjectorCode() {
            navigator.clipboard.writeText(injectorCode);
            alert('Copied! Paste this in JavaScript Injector plugin.');
        }

        function copyConsoleCode() {
            navigator.clipboard.writeText(consoleCode);
            alert('Copied! Paste in browser console (F12).');
        }

        function saveSettings() {
            const hours = document.getElementById('expireHours').value;
            localStorage.setItem('clipshare_expireHours', hours);
            alert('Settings saved! Default expiration: ' + hours + ' hours');
        }

        async function testScript() {
            const result = document.getElementById('testResult');
            result.innerHTML = 'Testing...';

            try {
                const resp = await fetch(scriptUrl);
                if (resp.ok) {
                    const text = await resp.text();
                    result.innerHTML = '<span style="color:#4caf50">‚úì Script OK (' + text.length + ' bytes)</span>';
                } else {
                    result.innerHTML = '<span style="color:#f44336">‚úó Error: HTTP ' + resp.status + '</span>';
                }
            } catch (e) {
                result.innerHTML = '<span style="color:#f44336">‚úó Error: ' + e.message + '</span>';
            }
        }

        function reloadScript() {
            window.__clipshare_loaded = false;
            const oldScript = document.querySelector('script[src*="/ClipShare/script"]');
            if (oldScript) oldScript.remove();

            const s = document.createElement('script');
            s.src = scriptUrl + '?t=' + Date.now();
            s.onload = () => {
                document.getElementById('testResult').innerHTML = '<span style="color:#4caf50">‚úì Script reloaded!</span>';
            };
            s.onerror = () => {
                document.getElementById('testResult').innerHTML = '<span style="color:#f44336">‚úó Failed to load</span>';
            };
            document.head.appendChild(s);
        }

        function installUserscript() {
            const userscript = `// ==UserScript==
// @name         ClipShare for Jellyfin
// @namespace    http://tampermonkey.net/
// @version      1.0
// @description  Create clips from Jellyfin video player
// @match        ${baseUrl}/*
// @grant        none
// ==/UserScript==

(function() {
    'use strict';
    var s = document.createElement('script');
    s.src = '${scriptUrl}';
    document.head.appendChild(s);
})();`;

            const blob = new Blob([userscript], { type: 'text/javascript' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'clipshare.user.js';
            a.click();
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>
